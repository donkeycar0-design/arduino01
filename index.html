<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì—°êµ¬ì‹¤ ê³µê¸°ì§ˆ ëª¨ë‹ˆí„°ë§</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Pretendard ë° ê³ ëŒ€ë¹„ ë””ì§€í„¸ í°íŠ¸ ë¡œë“œ */
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Pretendard:wght@400;600;700;800&display=swap');
    
    /* ê¹”ë”í•œ ì„¸ë¸ ì„¸ê·¸ë¨¼íŠ¸ ë³¼ë“œ í°íŠ¸ */
    @font-face {
      font-family: 'DSEG7-Bold';
      src: url('https://cdn.jsdelivr.net/gh/keshikan/DSEG@v0.46/fonts/DSEG7-Classic/DSEG7Classic-Bold.woff2') format('woff2');
    }

    body {
      font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
    }

    /* ì”ìƒ ì—†ëŠ” ê¹”ë”í•œ ë³¼ë“œ ë””ì§€í„¸ ìŠ¤íƒ€ì¼ */
    .digital-segment-bold {
      font-family: 'DSEG7-Bold', sans-serif;
      font-weight: 900;
      letter-spacing: 0.02em;
    }

    /* ì¹´ë“œ ë°°ê²½ íš¨ê³¼ */
    .temp-card {
      background: linear-gradient(135deg, #fff 0%, #fffaf5 100%);
      border: 1px solid rgba(249, 115, 22, 0.15);
    }
    
    .humi-card {
      background: linear-gradient(135deg, #fff 0%, #f5faff 100%);
      border: 1px solid rgba(59, 130, 246, 0.15);
    }

    .status-dot {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4 md:p-8">

  <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- ì™¼ìª½: í˜„ì¬ ìˆ˜ì¹˜ ì¹´ë“œ -->
    <div class="lg:col-span-1 bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100 flex flex-col">
      <!-- í—¤ë” -->
      <div class="bg-slate-900 py-4 px-6 text-white text-left">
        <div class="flex justify-between items-start mb-1">
          <span class="text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em]">Lab Air Quality Control</span>
          <div class="flex flex-col items-end">
            <!-- LIVE ìƒíƒœ í‘œì‹œ -->
            <div class="flex items-center gap-2">
              <span id="status-text" class="text-[10px] font-bold text-green-400">LIVE</span>
              <div id="status-dot" class="w-2 h-2 bg-green-400 rounded-full status-dot"></div>
            </div>
            <!-- ì •ë³´ ì„¹ì…˜: ëª¨ë“  ê¸€ì í¬ê¸°ë¥¼ text-[9px]ë¡œ í†µì¼ -->
            <div class="flex flex-col items-end mt-1 space-y-0.5">
              <span class="text-[9px] font-bold text-green-400 text-right leading-tight max-w-[140px] opacity-90">
                Arduino R4 logging data to Google Sheets every minute
              </span>
              <span class="text-[9px] font-bold text-green-400 opacity-90">
                Contact: skids@hanmail.net
              </span>
              <span class="text-[9px] font-bold text-green-400 uppercase tracking-wider opacity-90">
                Kim ByungDoo
              </span>
            </div>
          </div>
        </div>
        <h1 class="text-3xl font-extrabold tracking-tight">ì—°êµ¬ì‹¤ ê³µê¸°ì§ˆ í˜„í™©</h1>
      </div>

      <div class="p-8 space-y-6 flex-grow">
        <div class="grid grid-cols-1 gap-4">
          
          <!-- Temperature Card -->
          <div class="p-6 rounded-3xl temp-card shadow-sm flex flex-col">
            <div class="text-left w-full mb-2">
              <div class="flex items-center gap-2">
                <span class="text-xl">ğŸŒ¡ï¸</span>
                <p class="text-slate-600 text-xs font-bold uppercase tracking-wider">Temperature</p>
              </div>
            </div>
            
            <div class="text-center py-4">
              <h2 id="temp" class="digital-segment-bold text-8xl text-orange-600 leading-none">
                --<span class="font-sans text-3xl ml-2 align-top text-slate-400">Â°C</span>
              </h2>
            </div>
          </div>
          
          <!-- Humidity Card -->
          <div class="p-6 rounded-3xl humi-card shadow-sm flex flex-col">
            <div class="text-left w-full mb-2">
              <div class="flex items-center gap-2">
                <span class="text-xl">ğŸ’§</span>
                <p class="text-slate-600 text-xs font-bold uppercase tracking-wider">Humidity</p>
              </div>
            </div>
            
            <div class="text-center py-4">
              <h2 id="humi" class="digital-segment-bold text-8xl text-blue-600 leading-none">
                --<span class="font-sans text-3xl ml-2 align-top text-slate-400">%</span>
              </h2>
            </div>
          </div>

        </div>

        <!-- ì—…ë°ì´íŠ¸ ì‹œê°„ -->
        <div class="pt-2">
          <div class="flex flex-col items-center text-center p-4 bg-slate-50 rounded-2xl border border-slate-100">
            <p class="text-slate-400 text-[9px] font-black mb-1 uppercase tracking-widest">Last Updated</p>
            <p id="time" class="font-mono text-slate-700 text-lg font-bold tracking-tighter">--:--:--</p>
          </div>
        </div>

        <!-- ë™ê¸°í™” ë²„íŠ¼ -->
        <button onclick="fetchData()" class="w-full py-4 px-4 bg-slate-900 hover:bg-black text-white font-bold rounded-2xl transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-xl active:scale-95">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M240,128a112,112,0,0,1-212.71,39.05,8,8,0,0,1,13.42-8.77A96,96,0,1,0,56.8,71.16L33.37,94.59A8,8,0,0,1,20,88.94V24a8,8,0,0,1,16,0V63.51L59.51,40A112,112,0,0,1,240,128Z"></path></svg>
          ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        </button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ê·¸ë˜í”„ ì„¹ì…˜ -->
    <div class="lg:col-span-2 bg-white rounded-3xl shadow-2xl p-6 border border-slate-100 flex flex-col min-h-[500px]">
      <div class="mb-6">
        <h3 class="text-xl font-extrabold text-slate-800">ì‹œê°„ë³„ ë³€í™” ì¶”ì´</h3>
        <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">Real-time Environmental Analytics</p>
      </div>
      <div class="flex-grow relative">
        <canvas id="sensorChart"></canvas>
      </div>
    </div>

  </div>

  <script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycby8r36nt4wp6hgltSaOY8O8NiYRnxRPq_LCYWLe4KvI6xUc7c5EZerDqhMezh7-huJj/exec";
    let myChart;

    function initChart() {
      const ctx = document.getElementById('sensorChart').getContext('2d');
      Chart.defaults.font.family = 'Pretendard';
      
      myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: 'ì˜¨ë„ (Â°C)',
              data: [],
              borderColor: '#f97316',
              backgroundColor: 'rgba(249, 115, 22, 0.05)',
              borderWidth: 3,
              pointRadius: 3,
              tension: 0.4,
              fill: true,
              yAxisID: 'y'
            },
            {
              label: 'ìŠµë„ (%)',
              data: [],
              borderColor: '#3b82f6',
              backgroundColor: 'rgba(59, 130, 246, 0.05)',
              borderWidth: 3,
              pointRadius: 3,
              tension: 0.4,
              fill: true,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top', labels: { font: { weight: '700' } } }
          },
          scales: {
            x: { grid: { display: false } },
            y: { type: 'linear', display: true, position: 'left', suggestedMin: 15, suggestedMax: 35 },
            y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, suggestedMin: 20, suggestedMax: 80 }
          }
        }
      });
    }

    async function fetchData() {
      const timeEl = document.getElementById("time");
      const tempEl = document.getElementById("temp");
      const humiEl = document.getElementById("humi");

      try {
        const response = await fetch(webAppUrl);
        let responseData = await response.json();
        let history = Array.isArray(responseData) ? responseData : [responseData];

        if (history.length > 0) {
          const latest = history[history.length - 1];
          tempEl.innerHTML = Math.round(latest.temp) + '<span class="font-sans text-3xl ml-2 align-top text-slate-400">Â°C</span>';
          humiEl.innerHTML = Math.round(latest.humi) + '<span class="font-sans text-3xl ml-2 align-top text-slate-400">%</span>';
          
          const date = new Date(latest.time);
          timeEl.innerText = date.toLocaleTimeString('ko-KR', { hour12: false });

          const labels = [];
          const tVals = [];
          const hVals = [];
          history.forEach(item => {
            const d = new Date(item.time);
            labels.push(d.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }));
            tVals.push(item.temp);
            hVals.push(item.humi);
          });
          myChart.data.labels = labels;
          myChart.data.datasets[0].data = tVals;
          myChart.data.datasets[1].data = hVals;
          myChart.update();
        }
      } catch (e) { console.error(e); }
    }

    window.onload = () => { initChart(); fetchData(); setInterval(fetchData, 60000); };
  </script>
</body>
</html>
